<?xml version="1.0" encoding="UTF-8"?>
<pd:ProcessDefinition xmlns:ns2="http://xmlns.heb.com/ei/ErrorManagementSchema" xmlns:pd="http://xmlns.tibco.com/bw/process/2003" xmlns:ns1="http://www.tibco.com/pe/GenerateErrorActivity/InputSchema" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:ns="http://www.tibco.com/pe/DeployedVarsType" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:tib="http://www.tibco.com/bw/xslt/custom-functions" xmlns:pfx2="http://www.tibco.com/ns/no_namespace_schema_location/Shared Resources/Schema Definitions/Custom/Order_Detail.xsd" xmlns:pfx="http://www.heb.com/web_order">
    <xsd:import namespace="http://www.heb.com/web_order" schemaLocation="/Shared Resources/Schema Definitions/Custom/Web_Order.xsd"/>
    <xsd:import namespace="http://xmlns.heb.com/ei/ErrorManagementSchema" schemaLocation="/Shared Resources/Schema Definitions/Common/ErrorManagementSchema_SOAP.xsd"/>
    <xsd:import namespace="http://www.heb.com/web_order" schemaLocation="/Shared Resources/Schema Definitions/Custom/External_Order.xsd"/>
    <xsd:import namespace="http://www.tibco.com/ns/no_namespace_schema_location/Shared Resources/Schema Definitions/Custom/Order_Detail.xsd" schemaLocation="/Shared Resources/Schema Definitions/Custom/Order_Detail.xsd"/>
    <pd:name>MagentoToPos Processes/Sub Process/Get_All_Ticket.process</pd:name>
    <pd:startName>Start</pd:startName>
    <pd:startType>
        <xsd:element name="order" type="xsd:string"/>
    </pd:startType>
    <pd:startX>37</pd:startX>
    <pd:startY>159</pd:startY>
    <pd:returnBindings>
        <pfx:WebOrder>
            <pfx:Header>
                <pfx:Version>
                    <xsl:value-of select="'2.0'"/>
                </pfx:Version>
                <pfx:WebOrderId>
                    <xsl:value-of select="$Parse-XML/pfx:order/pfx:header/pfx:web_order_id"/>
                </pfx:WebOrderId>
                <pfx:RequestedTS>
                    <xsl:value-of select="current-dateTime()"/>
                </pfx:RequestedTS>
                <pfx:StoreId>
                    <xsl:value-of select="tib:right($Get-Sucursal/root/SucursalId,'5')"/>
                </pfx:StoreId>
                <pfx:COMSFulfillmentOrderId>
                    <xsl:value-of select="'000001'"/>
                </pfx:COMSFulfillmentOrderId>
                <pfx:SupplierLocTypeCode>
                    <xsl:value-of select="'S'"/>
                </pfx:SupplierLocTypeCode>
                <pfx:SupplierLocId>
                    <xsl:value-of select="tib:right($Get-Sucursal/root/SucursalId,'5')"/>
                </pfx:SupplierLocId>
                <pfx:OrderTotal>
                    <xsl:value-of select="$Parse-XML/pfx:order/pfx:header/pfx:order_total"/>
                </pfx:OrderTotal>
                <pfx:ATGProfileId>
                    <xsl:value-of select="$Parse-XML/pfx:order/pfx:header/pfx:atg_profile_id"/>
                </pfx:ATGProfileId>
                <pfx:FulfillmentMode>
                    <xsl:value-of select="'ISS'"/>
                </pfx:FulfillmentMode>
                <pfx:TransactionType>
                    <xsl:value-of select="'SALE'"/>
                </pfx:TransactionType>
            </pfx:Header>
            <pfx:Payments>
                <xsl:for-each select="$CatalogoMaestro_Replay/AccumulatedOutput/pfx:order/pfx:payments/pfx:payment">
                    <pfx:Payment>
                        <pfx:Status>
                            <xsl:value-of select="'APPROVED'"/>
                        </pfx:Status>
                        <pfx:Method>
                            <xsl:value-of select="pfx:payment_method"/>
                        </pfx:Method>
                        <pfx:CardType>
                            <xsl:value-of select="'VISA'"/>
                        </pfx:CardType>
                        <pfx:TenderType>
                            <xsl:value-of select="pfx:media_id"/>
                        </pfx:TenderType>
                        <pfx:Authorization>
                            <pfx:Type>
                                <xsl:value-of select="'POST_AUTH'"/>
                            </pfx:Type>
                        </pfx:Authorization>
                        <pfx:TransactionID>
                            <xsl:value-of select="'56e5411b-b8ec-3000-0070-0003bac0f0a1'"/>
                        </pfx:TransactionID>
                        <pfx:Amount>
                            <xsl:value-of select="pfx:amount"/>
                        </pfx:Amount>
                        <pfx:Name>
                            <xsl:value-of select="pfx:name"/>
                        </pfx:Name>
                        <pfx:ReferenceNumber>
                            <xsl:value-of select="if(string-length(pfx:ReferenceNumber)!=0)&#xA;then&#xA;pfx:ReferenceNumber&#xA;else&#xA;'00000'"/>
                        </pfx:ReferenceNumber>
                        <pfx:MaskedCardNumber>
                            <xsl:value-of select="if(string-length(pfx:MaskedCardNumber)!=0)&#xA;then&#xA;pfx:MaskedCardNumber&#xA;else&#xA;'00000'"/>
                        </pfx:MaskedCardNumber>
                    </pfx:Payment>
                </xsl:for-each>
            </pfx:Payments>
            <pfx:LineItems>
                <xsl:for-each select="$Response_UPC_Depto/AccumulatedOutput/pfx:order/pfx:detail">
                    <pfx:LineItem>
                        <pfx:ItemSeqNumber>
                            <xsl:value-of select="1"/>
                        </pfx:ItemSeqNumber>
                        <pfx:UPC>
                            <xsl:value-of select="pfx:sku"/>
                        </pfx:UPC>
                        <xsl:if test="pfx:pss_department">
                            <pfx:PSSDepartment>
                                <xsl:value-of select="pfx:pss_department"/>
                            </pfx:PSSDepartment>
                        </xsl:if>
                        <pfx:UnitPrice>
                            <xsl:value-of select="pfx:price"/>
                        </pfx:UnitPrice>
                        <pfx:UOM>
                            <xsl:value-of select="if(pfx:uom='each')&#xA;then&#xA;'EACH'&#xA;else&#xA;'WEIGHT'"/>
                        </pfx:UOM>
                        <pfx:Quantity>
                            <xsl:value-of select="pfx:quantity"/>
                        </pfx:Quantity>
                        <xsl:for-each select="pfx:item_discounts">
                            <pfx:Discounts>
                                <xsl:for-each select="pfx:item_discount">
                                    <pfx:Discount>
                                        <pfx:OfferType>
                                            <xsl:value-of select="pfx:offer_type"/>
                                        </pfx:OfferType>
                                        <pfx:OfferId>
                                            <xsl:value-of select="pfx:offer_id"/>
                                        </pfx:OfferId>
                                        <pfx:OrderLevelDiscountFlag>
                                            <xsl:value-of select="0"/>
                                        </pfx:OrderLevelDiscountFlag>
                                        <pfx:DiscountAmount>
                                            <xsl:value-of select="pfx:discount_amount"/>
                                        </pfx:DiscountAmount>
                                        <pfx:ChargeBackAccount>
                                            <xsl:value-of select="pfx:chargeback_acct"/>
                                        </pfx:ChargeBackAccount>
                                    </pfx:Discount>
                                </xsl:for-each>
                            </pfx:Discounts>
                        </xsl:for-each>
                    </pfx:LineItem>
                </xsl:for-each>
            </pfx:LineItems>
        </pfx:WebOrder>
    </pd:returnBindings>
    <pd:endName>End</pd:endName>
    <pd:endType ref="pfx:WebOrder"/>
    <pd:endX>1144</pd:endX>
    <pd:endY>169</pd:endY>
    <pd:errorSchemas>
        <Error ref="ns2:Fault"/>
    </pd:errorSchemas>
    <pd:processVariables/>
    <pd:targetNamespace>http://xmlns.example.com/1467912171463</pd:targetNamespace>
    <pd:group name="Group">
        <pd:type>com.tibco.pe.core.LoopGroup</pd:type>
        <pd:resourceType>ae.process.group</pd:resourceType>
        <pd:x>130</pd:x>
        <pd:y>19</pd:y>
        <pd:width>325</pd:width>
        <pd:height>265</pd:height>
        <pd:collapsedWidth>57</pd:collapsedWidth>
        <pd:collapsedHeight>70</pd:collapsedHeight>
        <pd:groupVariables/>
        <pd:joinToggle>inherit</pd:joinToggle>
        <config>
            <pd:groupType>inputLoop</pd:groupType>
            <pd:serializable>false</pd:serializable>
            <pd:over>$Parse-XML/pfx:order/pfx:detail</pd:over>
            <pd:iterationElementSlot>Sku_Depto</pd:iterationElementSlot>
            <pd:indexSlot>Array</pd:indexSlot>
            <pd:outSlot>Replay_Sku</pd:outSlot>
            <pd:activityOutputName>Call_Get_Upc_Depto</pd:activityOutputName>
            <pd:accumulateOutput>true</pd:accumulateOutput>
        </config>
        <pd:inputBindings/>
        <pd:expanded>true</pd:expanded>
        <pd:transition>
            <pd:from>start</pd:from>
            <pd:to>Map-Data-2</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Call_Get_Upc_Depto</pd:from>
            <pd:to>end</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Map-Data-2</pd:from>
            <pd:to>Call_Get_Upc_Depto</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>xpath</pd:conditionType>
            <pd:xpath>$Map-Data-2/order_detail/detail/quantity!=0</pd:xpath>
        </pd:transition>
        <pd:transition>
            <pd:from>Map-Data-2</pd:from>
            <pd:to>Null</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>otherwise</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Null</pd:from>
            <pd:to>Fault 21</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:activity name="Call_Get_Upc_Depto">
            <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
            <pd:resourceType>ae.process.subprocess</pd:resourceType>
            <pd:x>347</pd:x>
            <pd:y>79</pd:y>
            <config>
                <processName>/MagentoToPos Processes/Sub Process/Get_UPC_Depto.process</processName>
            </config>
            <pd:inputBindings>
                <order_detail>
                    <detail>
                        <idsucursal>
                            <xsl:value-of select="tib:right($Parse-XML/pfx:order/pfx:header/pfx:store_id, 4)"/>
                        </idsucursal>
                        <websiteid>
                            <xsl:value-of select="$Parse-XML/pfx:order/pfx:header/pfx:store_id"/>
                        </websiteid>
                        <sku>
                            <xsl:value-of select="$Sku_Depto/pfx:detail/pfx:sku"/>
                        </sku>
                        <pss_departament>
                            <xsl:value-of select="$Sku_Depto/pfx:detail/pfx:pss_department"/>
                        </pss_departament>
                        <price>
                            <xsl:value-of select="$Sku_Depto/pfx:detail/pfx:price"/>
                        </price>
                        <quantity>
                            <xsl:value-of select="$Sku_Depto/pfx:detail/pfx:quantity"/>
                        </quantity>
                        <xsl:for-each xmlns:xsl="http://www.w3.org/1999/XSL/Transform" select="$Sku_Depto/pfx:detail/pfx:item_discounts">
                            <item_discounts>
                                <xsl:for-each select="pfx:item_discount">
                                    <item_discount>
                                        <discount_amount>
                                            <xsl:value-of select="pfx:discount_amount"/>
                                        </discount_amount>
                                        <offer_type>
                                            <xsl:value-of select="pfx:offer_type"/>
                                        </offer_type>
                                        <offer_id>
                                            <xsl:value-of select="pfx:offer_id"/>
                                        </offer_id>
                                        <chargeback_acct>
                                            <xsl:value-of select="pfx:chargeback_acct"/>
                                        </chargeback_acct>
                                    </item_discount>
                                </xsl:for-each>
                            </item_discounts>
                        </xsl:for-each>
                        <uom>
                            <xsl:value-of select="$Sku_Depto/pfx:detail/pfx:uom"/>
                        </uom>
                        <tax_flag>
                            <xsl:value-of select="$Sku_Depto/pfx:detail/pfx:tax_flag"/>
                        </tax_flag>
                        <xsl:for-each xmlns:xsl="http://www.w3.org/1999/XSL/Transform" select="$Sku_Depto/pfx:detail/pfx:tax">
                            <tax>
                                <tax_amount>
                                    <xsl:value-of select="pfx:tax_amount"/>
                                </tax_amount>
                                <tax_rate>
                                    <xsl:value-of select="pfx:tax_rate"/>
                                </tax_rate>
                            </tax>
                        </xsl:for-each>
                    </detail>
                </order_detail>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="Map-Data-2">
            <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
            <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
            <pd:x>184</pd:x>
            <pd:y>79</pd:y>
            <config>
                <element ref="pfx2:order_detail"/>
            </config>
            <pd:inputBindings>
                <order_detail>
                    <detail>
                        <idsucursal>
                            <xsl:value-of select="$Parse-XML/pfx:order/pfx:header/pfx:store_id"/>
                        </idsucursal>
                        <websiteid>
                            <xsl:value-of select="$Parse-XML/pfx:order/pfx:header/pfx:order_total"/>
                        </websiteid>
                        <sku>
                            <xsl:value-of select="$Sku_Depto/pfx:detail/pfx:sku"/>
                        </sku>
                        <pss_departament>
                            <xsl:value-of select="$Sku_Depto/pfx:detail/pfx:pss_department"/>
                        </pss_departament>
                        <price>
                            <xsl:value-of select="$Sku_Depto/pfx:detail/pfx:price"/>
                        </price>
                        <quantity>
                            <xsl:value-of select="$Sku_Depto/pfx:detail/pfx:quantity"/>
                        </quantity>
                        <xsl:for-each xmlns:xsl="http://www.w3.org/1999/XSL/Transform" select="$Sku_Depto/pfx:detail/pfx:item_discounts">
                            <item_discounts>
                                <xsl:for-each select="pfx:item_discount">
                                    <item_discount>
                                        <discount_amount>
                                            <xsl:value-of select="pfx:discount_amount"/>
                                        </discount_amount>
                                        <offer_type>
                                            <xsl:value-of select="pfx:offer_type"/>
                                        </offer_type>
                                        <offer_id>
                                            <xsl:value-of select="pfx:offer_id"/>
                                        </offer_id>
                                        <chargeback_acct>
                                            <xsl:value-of select="pfx:chargeback_acct"/>
                                        </chargeback_acct>
                                    </item_discount>
                                </xsl:for-each>
                            </item_discounts>
                        </xsl:for-each>
                        <uom>
                            <xsl:value-of select="$Sku_Depto/pfx:detail/pfx:uom"/>
                        </uom>
                        <tax_flag>
                            <xsl:value-of select="$Sku_Depto/pfx:detail/pfx:tax_flag"/>
                        </tax_flag>
                        <xsl:for-each xmlns:xsl="http://www.w3.org/1999/XSL/Transform" select="$Sku_Depto/pfx:detail/pfx:tax">
                            <tax>
                                <tax_amount>
                                    <xsl:value-of select="pfx:tax_amount"/>
                                </tax_amount>
                                <tax_rate>
                                    <xsl:value-of select="pfx:tax_rate"/>
                                </tax_rate>
                            </tax>
                        </xsl:for-each>
                    </detail>
                </order_detail>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="Null">
            <pd:type>com.tibco.plugin.timer.NullActivity</pd:type>
            <pd:resourceType>ae.activities.null</pd:resourceType>
            <pd:x>185</pd:x>
            <pd:y>204</pd:y>
            <config/>
            <pd:inputBindings/>
        </pd:activity>
        <pd:activity name="Fault 21">
            <pd:type>com.tibco.pe.core.GenerateErrorActivity</pd:type>
            <pd:resourceType>ae.activities.throw</pd:resourceType>
            <pd:x>360</pd:x>
            <pd:y>204</pd:y>
            <config>
                <faultName>Error</faultName>
            </config>
            <pd:inputBindings>
                <ns1:ActivityInput>
                    <message/>
                    <data>
                        <ns2:Fault>
                            <ns2:Code>
                                <xsl:value-of select="'Fault 21'"/>
                            </ns2:Code>
                            <ns2:Reason>
                                <xsl:value-of select="concat($_globalVariables/ns:GlobalVariables/MagentoToPos_Error/Fault_21,' ',$Map-Data-2/order_detail/detail[1]/sku,' ',$_globalVariables/ns:GlobalVariables/MagentoToPos_Error/Fault_22)"/>
                            </ns2:Reason>
                        </ns2:Fault>
                    </data>
                </ns1:ActivityInput>
            </pd:inputBindings>
        </pd:activity>
    </pd:group>
    <pd:group name="Group (2)">
        <pd:type>com.tibco.pe.core.LoopGroup</pd:type>
        <pd:resourceType>ae.process.group</pd:resourceType>
        <pd:x>480</pd:x>
        <pd:y>23</pd:y>
        <pd:width>140</pd:width>
        <pd:height>261</pd:height>
        <pd:collapsedWidth>57</pd:collapsedWidth>
        <pd:collapsedHeight>70</pd:collapsedHeight>
        <pd:groupVariables/>
        <pd:joinToggle>inherit</pd:joinToggle>
        <config>
            <pd:groupType>inputLoop</pd:groupType>
            <pd:serializable>false</pd:serializable>
            <pd:over>$Call_Get_Upc_Depto/order_detail/detail</pd:over>
            <pd:iterationElementSlot>Replay_UPC_DEPTO</pd:iterationElementSlot>
            <pd:indexSlot>Array_Upc_Depto</pd:indexSlot>
            <pd:outSlot>Response_UPC_Depto</pd:outSlot>
            <pd:activityOutputName>Map Data</pd:activityOutputName>
            <pd:accumulateOutput>true</pd:accumulateOutput>
        </config>
        <pd:inputBindings/>
        <pd:expanded>true</pd:expanded>
        <pd:transition>
            <pd:from>start</pd:from>
            <pd:to>Map Data</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Map Data</pd:from>
            <pd:to>end</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Map Data</pd:from>
            <pd:to>Fault-11</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-65536</pd:lineColor>
            <pd:conditionType>error</pd:conditionType>
        </pd:transition>
        <pd:activity name="Map Data">
            <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
            <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
            <pd:x>537</pd:x>
            <pd:y>86</pd:y>
            <config>
                <element ref="pfx:order"/>
            </config>
            <pd:inputBindings>
                <pfx:order>
                    <xsl:for-each xmlns:xsl="http://www.w3.org/1999/XSL/Transform" select="$Parse-XML/pfx:order/pfx:header">
                        <pfx:header>
                            <pfx:store_id>
                                <xsl:value-of select="concat('0',tib:right(pfx:store_id,4))"/>
                            </pfx:store_id>
                            <pfx:order_total>
                                <xsl:value-of select="pfx:order_total"/>
                            </pfx:order_total>
                            <pfx:tax_exempt>
                                <xsl:value-of select="pfx:tax_exempt"/>
                            </pfx:tax_exempt>
                            <pfx:tax_total>
                                <xsl:value-of select="pfx:tax_total"/>
                            </pfx:tax_total>
                            <pfx:web_order_id>
                                <xsl:value-of select="pfx:web_order_id"/>
                            </pfx:web_order_id>
                            <pfx:atg_profile_id>
                                <xsl:value-of select="pfx:atg_profile_id"/>
                            </pfx:atg_profile_id>
                        </pfx:header>
                    </xsl:for-each>
                    <xsl:for-each xmlns:xsl="http://www.w3.org/1999/XSL/Transform" select="$Parse-XML/pfx:order/pfx:payments">
                        <pfx:payments>
                            <xsl:for-each select="pfx:payment">
                                <pfx:payment>
                                    <pfx:payment_method>
                                        <xsl:value-of select="pfx:payment_method"/>
                                    </pfx:payment_method>
                                    <pfx:media_id>
                                        <xsl:value-of select="pfx:media_id"/>
                                    </pfx:media_id>
                                    <pfx:amount>
                                        <xsl:value-of select="pfx:amount"/>
                                    </pfx:amount>
                                    <pfx:name>
                                        <xsl:value-of select="pfx:name"/>
                                    </pfx:name>
                                    <pfx:ReferenceNumber>
                                        <xsl:value-of select="pfx:ReferenceNumber"/>
                                    </pfx:ReferenceNumber>
                                    <pfx:MaskedCardNumber>
                                        <xsl:value-of select="pfx:MaskedCardNumber"/>
                                    </pfx:MaskedCardNumber>
                                </pfx:payment>
                            </xsl:for-each>
                        </pfx:payments>
                    </xsl:for-each>
                    <xsl:copy-of select="$Parse-XML/pfx:order/pfx:basket_discounts"/>
                    <xsl:for-each xmlns:xsl="http://www.w3.org/1999/XSL/Transform" select="$Replay_Sku/AccumulatedOutput/order_detail/detail">
                        <pfx:detail>
                            <pfx:sku>
                                <xsl:value-of select="sku"/>
                            </pfx:sku>
                            <pfx:pss_department>
                                <xsl:value-of select="pss_departament"/>
                            </pfx:pss_department>
                            <pfx:price>
                                <xsl:value-of select="price"/>
                            </pfx:price>
                            <pfx:quantity>
                                <xsl:value-of select="quantity"/>
                            </pfx:quantity>
                            <xsl:for-each select="item_discounts">
                                <pfx:item_discounts>
                                    <xsl:for-each select="item_discount">
                                        <pfx:item_discount>
                                            <pfx:discount_amount>
                                                <xsl:value-of select="discount_amount"/>
                                            </pfx:discount_amount>
                                            <pfx:offer_type>
                                                <xsl:value-of select="offer_type"/>
                                            </pfx:offer_type>
                                            <pfx:offer_id>
                                                <xsl:value-of select="offer_id"/>
                                            </pfx:offer_id>
                                            <pfx:chargeback_acct>
                                                <xsl:value-of select="if(string-length(chargeback_acct)=3)&#xA;then &#xA;concat('0',chargeback_acct)&#xA;else&#xA;chargeback_acct"/>
                                            </pfx:chargeback_acct>
                                        </pfx:item_discount>
                                    </xsl:for-each>
                                </pfx:item_discounts>
                            </xsl:for-each>
                            <pfx:uom>
                                <xsl:value-of select="uom"/>
                            </pfx:uom>
                            <pfx:tax_flag>
                                <xsl:value-of select="tax_flag"/>
                            </pfx:tax_flag>
                            <xsl:for-each select="tax">
                                <pfx:tax>
                                    <pfx:tax_amount>
                                        <xsl:value-of select="tax_amount"/>
                                    </pfx:tax_amount>
                                    <pfx:tax_rate>
                                        <xsl:value-of select="tax_rate"/>
                                    </pfx:tax_rate>
                                </pfx:tax>
                            </xsl:for-each>
                        </pfx:detail>
                    </xsl:for-each>
                </pfx:order>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="Fault-11">
            <pd:type>com.tibco.pe.core.GenerateErrorActivity</pd:type>
            <pd:resourceType>ae.activities.throw</pd:resourceType>
            <pd:x>539</pd:x>
            <pd:y>207</pd:y>
            <config>
                <faultName>Error</faultName>
            </config>
            <pd:inputBindings>
                <ns1:ActivityInput>
                    <data>
                        <ns2:Fault>
                            <ns2:Code>
                                <xsl:value-of select="'Fault 11'"/>
                            </ns2:Code>
                            <ns2:Reason>
                                <xsl:value-of select="$_globalVariables/ns:GlobalVariables/MagentoToPos_Error/Fault_10"/>
                            </ns2:Reason>
                        </ns2:Fault>
                    </data>
                </ns1:ActivityInput>
            </pd:inputBindings>
        </pd:activity>
    </pd:group>
    <pd:group name="Group (1)">
        <pd:type>com.tibco.pe.core.LoopGroup</pd:type>
        <pd:resourceType>ae.process.group</pd:resourceType>
        <pd:x>665</pd:x>
        <pd:y>44</pd:y>
        <pd:width>258</pd:width>
        <pd:height>231</pd:height>
        <pd:collapsedWidth>57</pd:collapsedWidth>
        <pd:collapsedHeight>70</pd:collapsedHeight>
        <pd:groupVariables/>
        <pd:joinToggle>inherit</pd:joinToggle>
        <config>
            <pd:groupType>inputLoop</pd:groupType>
            <pd:serializable>false</pd:serializable>
            <pd:over>$Parse-XML/pfx:order/pfx:payments/pfx:payment</pd:over>
            <pd:iterationElementSlot>payments</pd:iterationElementSlot>
            <pd:indexSlot>i</pd:indexSlot>
            <pd:outSlot>CatalogoMaestro_Replay</pd:outSlot>
            <pd:activityOutputName>Map-Data-1</pd:activityOutputName>
            <pd:accumulateOutput>true</pd:accumulateOutput>
        </config>
        <pd:inputBindings/>
        <pd:expanded>true</pd:expanded>
        <pd:transition>
            <pd:from>start</pd:from>
            <pd:to>Get_CatalogoMaestro</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Map-Data-1</pd:from>
            <pd:to>end</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Get_CatalogoMaestro</pd:from>
            <pd:to>Map-Data-1</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-16777216</pd:lineColor>
            <pd:conditionType>always</pd:conditionType>
        </pd:transition>
        <pd:transition>
            <pd:from>Map-Data-1</pd:from>
            <pd:to>Fault-10</pd:to>
            <pd:lineType>Default</pd:lineType>
            <pd:lineColor>-65536</pd:lineColor>
            <pd:conditionType>error</pd:conditionType>
        </pd:transition>
        <pd:activity name="Get_CatalogoMaestro">
            <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
            <pd:resourceType>ae.process.subprocess</pd:resourceType>
            <pd:x>746</pd:x>
            <pd:y>109</pd:y>
            <config>
                <processName>/MagentoToPos Processes/Sub Process/Get_ CatalogoMaestroDetalle.process</processName>
            </config>
            <pd:inputBindings>
                <root>
                    <ClaveExterna>
                        <xsl:value-of select="$payments/pfx:payment/pfx:media_id"/>
                    </ClaveExterna>
                </root>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="Map-Data-1">
            <pd:type>com.tibco.plugin.mapper.MapperActivity</pd:type>
            <pd:resourceType>ae.activities.MapperActivity</pd:resourceType>
            <pd:x>843</pd:x>
            <pd:y>107</pd:y>
            <config>
                <element ref="pfx:order"/>
            </config>
            <pd:inputBindings>
                <pfx:order>
                    <xsl:for-each xmlns:xsl="http://www.w3.org/1999/XSL/Transform" select="$Parse-XML/pfx:order/pfx:header">
                        <pfx:header>
                            <pfx:store_id>
                                <xsl:value-of select="concat('0',tib:right(pfx:store_id, 4))"/>
                            </pfx:store_id>
                            <pfx:order_total>
                                <xsl:value-of select="pfx:order_total"/>
                            </pfx:order_total>
                            <pfx:tax_exempt>
                                <xsl:value-of select="pfx:tax_exempt"/>
                            </pfx:tax_exempt>
                            <pfx:tax_total>
                                <xsl:value-of select="pfx:tax_total"/>
                            </pfx:tax_total>
                            <pfx:web_order_id>
                                <xsl:value-of select="pfx:web_order_id"/>
                            </pfx:web_order_id>
                            <pfx:atg_profile_id>
                                <xsl:value-of select="pfx:atg_profile_id"/>
                            </pfx:atg_profile_id>
                        </pfx:header>
                    </xsl:for-each>
                    <pfx:payments>
                        <pfx:payment>
                            <pfx:payment_method>
                                <xsl:value-of select="$Get_CatalogoMaestro/root/Referencia[1]"/>
                            </pfx:payment_method>
                            <pfx:media_id>
                                <xsl:value-of select="$payments/pfx:payment/pfx:media_id"/>
                            </pfx:media_id>
                            <pfx:amount>
                                <xsl:value-of select="$payments/pfx:payment/pfx:amount"/>
                            </pfx:amount>
                            <pfx:name>
                                <xsl:value-of select="$payments/pfx:payment/pfx:name"/>
                            </pfx:name>
                            <pfx:ReferenceNumber>
                                <xsl:value-of select="$payments/pfx:payment/pfx:ReferenceNumber"/>
                            </pfx:ReferenceNumber>
                            <pfx:MaskedCardNumber>
                                <xsl:value-of select="$payments/pfx:payment/pfx:MaskedCardNumber"/>
                            </pfx:MaskedCardNumber>
                        </pfx:payment>
                    </pfx:payments>
                    <xsl:copy-of select="$Parse-XML/pfx:order/pfx:basket_discounts"/>
                    <xsl:for-each xmlns:xsl="http://www.w3.org/1999/XSL/Transform" select="$Parse-XML/pfx:order/pfx:detail">
                        <pfx:detail>
                            <pfx:sku>
                                <xsl:value-of select="0"/>
                            </pfx:sku>
                            <pfx:pss_department>
                                <xsl:value-of select="0"/>
                            </pfx:pss_department>
                            <pfx:price>
                                <xsl:value-of select="pfx:price"/>
                            </pfx:price>
                            <pfx:quantity>
                                <xsl:value-of select="pfx:quantity"/>
                            </pfx:quantity>
                            <xsl:for-each select="pfx:item_discounts">
                                <pfx:item_discounts>
                                    <xsl:for-each select="pfx:item_discount">
                                        <pfx:item_discount>
                                            <pfx:discount_amount>
                                                <xsl:value-of select="pfx:discount_amount"/>
                                            </pfx:discount_amount>
                                            <pfx:offer_type>
                                                <xsl:value-of select="pfx:offer_type"/>
                                            </pfx:offer_type>
                                            <pfx:offer_id>
                                                <xsl:value-of select="pfx:offer_id"/>
                                            </pfx:offer_id>
                                            <pfx:chargeback_acct>
                                                <xsl:value-of select="if(string-length(pfx:chargeback_acct)=3)&#xA;then &#xA;concat('0',pfx:chargeback_acct)&#xA;else&#xA;pfx:chargeback_acct"/>
                                            </pfx:chargeback_acct>
                                        </pfx:item_discount>
                                    </xsl:for-each>
                                </pfx:item_discounts>
                            </xsl:for-each>
                            <pfx:uom>
                                <xsl:value-of select="pfx:uom"/>
                            </pfx:uom>
                            <pfx:tax_flag>
                                <xsl:value-of select="pfx:tax_flag"/>
                            </pfx:tax_flag>
                        </pfx:detail>
                    </xsl:for-each>
                </pfx:order>
            </pd:inputBindings>
        </pd:activity>
        <pd:activity name="Fault-10">
            <pd:type>com.tibco.pe.core.GenerateErrorActivity</pd:type>
            <pd:resourceType>ae.activities.throw</pd:resourceType>
            <pd:x>770</pd:x>
            <pd:y>198</pd:y>
            <config>
                <faultName>Error</faultName>
            </config>
            <pd:inputBindings>
                <ns1:ActivityInput>
                    <data>
                        <ns2:Fault>
                            <ns2:Code>
                                <xsl:value-of select="'Fault 10'"/>
                            </ns2:Code>
                            <ns2:Reason>
                                <xsl:value-of select="$_globalVariables/ns:GlobalVariables/MagentoToPos_Error/Fault_10"/>
                            </ns2:Reason>
                        </ns2:Fault>
                    </data>
                </ns1:ActivityInput>
            </pd:inputBindings>
        </pd:activity>
    </pd:group>
    <pd:activity name="Get Sucursal">
        <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
        <pd:resourceType>ae.process.subprocess</pd:resourceType>
        <pd:x>1006</pd:x>
        <pd:y>167</pd:y>
        <config>
            <processName>/MagentoToPos Processes/Sub Process/Get_RelacionSucursalWebsite.process</processName>
        </config>
        <pd:inputBindings>
            <root>
                <WebsiteId>
                    <xsl:value-of select="$Parse-XML/pfx:order/pfx:header/pfx:store_id"/>
                </WebsiteId>
            </root>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="Parse XML">
        <pd:type>com.tibco.plugin.xml.XMLParseActivity</pd:type>
        <pd:resourceType>ae.activities.XMLParseActivity</pd:resourceType>
        <pd:x>38</pd:x>
        <pd:y>346</pd:y>
        <config>
            <inputStyle>text</inputStyle>
            <xsdVersion>default</xsdVersion>
            <validateOutput>false</validateOutput>
            <term ref="pfx:order"/>
        </config>
        <pd:inputBindings>
            <xmlString>
                <xsl:value-of select="$Start/order"/>
            </xmlString>
        </pd:inputBindings>
    </pd:activity>
    <pd:transition>
        <pd:from>Start</pd:from>
        <pd:to>Parse XML</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Group</pd:from>
        <pd:to>Group (2)</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Group (2)</pd:from>
        <pd:to>Group (1)</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Group (1)</pd:from>
        <pd:to>Get Sucursal</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Get Sucursal</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Parse XML</pd:from>
        <pd:to>Group</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
</pd:ProcessDefinition>